% Add required packages
\usepackage{pdfpages}
\usepackage{fancyhdr}
\usepackage{geometry}
\usepackage{colortbl}
\usepackage{array}
\usepackage{graphicx}
\usepackage{afterpage}
\usepackage{tabularx}
\usepackage{titlesec}

% Redefine chapter format to look like a section and remove page breaks
\titleclass{\chapter}{top}
\titleformat{\chapter}{\Large\bfseries}{\thechapter.}{1em}{}
\titlespacing*{\chapter}{0pt}{0.2ex}{2.3ex plus .2ex}
\assignpagestyle{\chapter}{fancy}

% Set page geometry for whole document
\geometry{
  a4paper,
  top=15mm,
  bottom=\revisionTableHeight,
  left=20mm,
  right=15mm,
  includeheadfoot
}

% Set header height
\setlength{\headheight}{65pt}

% Ensure header occupies full width
\setlength{\headwidth}{\textwidth}
% \addtolength{\headwidth}{-35mm}

\pagestyle{fancy}
\renewcommand{\headrulewidth}{0pt}
\renewcommand{\footrulewidth}{0pt}
\fancyhead{} % clear all header fields

\fancyhead[C]{%
  \begin{tabularx}{\textwidth}{|l|X|l|r|}
    \hline
    %  first row
    \raisebox{-0.5\height}{\includegraphics[height=1.3cm]{\logoCompany}} & 
    \multicolumn{2}{c|}{\raisebox{-0.5\height}{\textbf{\fontsize{24}{29}\selectfont Calculation Sheet}}} & 
    \raisebox{-0.5\height}{\includegraphics[height=1.3cm]{\logoClient}} \\ 
    \hline
    % 2nd row
    \multicolumn{1}{|l|}{\textbf{\fontsize{9}{11}\selectfont Project Title}} & 
    \multicolumn{1}{l}{\fontsize{9}{11}\selectfont \projTitle} & 
    \multicolumn{1}{|l|}{\textbf{\fontsize{9}{11}\selectfont Project No.}} & 
    \multicolumn{1}{l|}{\fontsize{9}{11}\selectfont \projNo} \\ 
    \cline{1-4}
    % 3rd row
    \multicolumn{1}{|l|}{\textbf{\fontsize{9}{11}\selectfont Client}} & 
    \multicolumn{1}{l}{\fontsize{9}{11}\selectfont \client} & 
    \multicolumn{1}{|l|}{\textbf{\fontsize{9}{11}\selectfont Calculation No.}} & 
    \multicolumn{1}{l|}{\fontsize{9}{11}\selectfont \calcNumber} \\ 
    \cline{1-4}
    %  4th row
    \multicolumn{1}{|l|}{\textbf{\fontsize{9}{11}\selectfont Calculation Title}} & 
    \multicolumn{1}{l}{\fontsize{9}{11}\selectfont \calcTitle} & 
    \multicolumn{1}{|l|}{\textbf{\fontsize{9}{11}\selectfont Revision}} & 
    \multicolumn{1}{l|}{\fontsize{9}{11}\selectfont \revNo} \\ 
    \cline{1-4}
    %  5th row
    \multicolumn{1}{|p{30mm}|}{\textbf{\fontsize{9}{11}\selectfont Project Phase}} & 
    \multicolumn{1}{X}{\fontsize{9}{11}\selectfont \projPhase} & 
    \multicolumn{1}{|p{25mm}|}{\textbf{\fontsize{9}{11}\selectfont Date}} & 
    \multicolumn{1}{p{25mm}|}{\fontsize{9}{11}\selectfont \calcDate} \\ 
    \cline{1-4}
  \end{tabularx}%
}  

% Define a custom page style for the first page, which includes the revision table

\fancypagestyle{firstpage}{  
    \fancyfoot[C]{% 
      \noindent\begin{minipage}{\linewidth}
        \begin{tabularx}{\headwidth}{|c|c|X|c|c|c|}
            \hline
            \multicolumn{1}{|>{\columncolor[RGB]{63,169,186}\color{white}}l|}{\textbf{\fontsize{9}{11}\selectfont Rev.}} & 
            \multicolumn{1}{>{\columncolor[RGB]{63,169,186}\color{white}}l|}{\textbf{\fontsize{9}{11}\selectfont Date}} & 
            \multicolumn{1}{>{\columncolor[RGB]{63,169,186}\color{white}}l|}{\textbf{\fontsize{9}{11}\selectfont Description}} & 
            \multicolumn{1}{>{\columncolor[RGB]{63,169,186}\color{white}}l|}{\textbf{\fontsize{9}{11}\selectfont Prepared}} & 
            \multicolumn{1}{>{\columncolor[RGB]{63,169,186}\color{white}}l|}{\textbf{\fontsize{9}{11}\selectfont Checked}} & 
            \multicolumn{1}{>{\columncolor[RGB]{63,169,186}\color{white}}l|}{\textbf{\fontsize{9}{11}\selectfont Approved}} \\ 
            \revisionData
            % \hline
        \end{tabularx}

        % add following disclaimer: 
        \vskip 2mm
            \fontsize{8}{11}\selectfont This calculation was prepared by \companyName\ pursuant to the Engineering Services Contract between \companyName\ and \client\ in connection with the services for \projTitle.
            % \fontsize{8}{11}\selectfont This calculation was prepared by \the\headwidth\ pursuant to the Engineering Services Contract between \the\linewidth\ and \client\ in connection with the services for \projTitle.
      \end{minipage}
    } 
}

% show first page style
\thispagestyle{firstpage}
 
% how to show the remaineder of the pages without the footer, and new bottom margin 


% set the appendix header formatting 
\newcommand{\appendixHeader}[1]{
     \begin{center}
     \vspace*{1cm}
     \textbf{\fontsize{24pt}{30pt}\selectfont #1} \\
     \end{center}
  }

% set the calc coverpage section header formatting
\newcommand{\coverpageHeader}[1]{
    \vspace*{0.5cm}
    \textbf{\fontsize{14pt}{1pt}\selectfont #1} \\
    \noindent\rule{\textwidth}{1pt}
    \vspace{-0.3cm}
  }
